# tech_spec.md — Centaur Trading Bot 技术规格与约束（v0.1）

> 目标：本地桌面 MVP 先做到 **不重复下单、不断线失忆、风控能砍手、出事能尸检**。
> 范围：US stocks，Alpaca（paper/live），Stop Buy / Stop Sell（含撤单/改单）。

---

## 0) 顶层硬约束（违反直接拒绝合并）

1. **买入必须人工确认；卖出/风控允许机器人自动执行**
2. **UI 不直连券商**：所有券商交互只能由 Engine 执行
3. **写操作必须幂等**：重复请求只能产生一次效果
4. **WS 不是事实来源**：必须有 REST 快照对账兜底

---

## 1) 系统边界与职责（必须遵守）

### 1.1 组件职责
- **UI（GUI）**：展示状态 + 发起“草稿/确认/执行/kill”等动作；不得直接调用券商。
- **API（边界层）**：接收命令、做防呆校验（确认票据/限速/基础去重）、写审计、提供查询；不得直接调用券商。
- **Engine（唯一执行者）**：消费命令、维护订单状态机、执行风控、对账、写状态与事件。

### 1.2 Single Writer（单写者）
- 每个 `profile_id` 在任意时刻 **只能有一个 Engine 实例**执行命令与写状态。
- 非 leader 实例必须只读，不得下单/撤单/触发风控动作。
